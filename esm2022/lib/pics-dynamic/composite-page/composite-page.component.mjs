import { Component, Input } from '@angular/core';
import { DynamicSearchComponent } from '../dynamic-search/dynamic-search.component';
import { AlertService } from '../@core/service/alert.service';
import { LocalService } from '../@core/service/local.service';
import { selectAllGridsterItems } from '../@shared/master-view-state/master-view.selectors';
import { clearComponents, setComponents } from '../@shared/master-view-state/master-view.actions';
import { FormPageComponent } from '../dynamic-tab-page/form-page/form-page.component';
import { DynamicPageComponent } from '../dynamic-tab-page/dynamic-page/dynamic-page.component';
import * as i0 from "@angular/core";
import * as i1 from "@angular/router";
import * as i2 from "../@core/service/dynamic-tab-page-service";
import * as i3 from "@ngrx/store";
import * as i4 from "@angular/common";
import * as i5 from "ng-dynamic-component";
import * as i6 from "primeng/accordion";
// import { DynamicPageModifyBypageidComponent } from '../dynamic-tab-page/dynamic-page-modify-bypageid/dynamic-page-modify-bypageid.component';
export class CompositePageComponent {
    route;
    dynamicTabPageService;
    store;
    CompositePageWidget$;
    compositePageId;
    id;
    alertService;
    storage;
    editMode = true;
    activeIndexes = [];
    constructor(injector, route, dynamicTabPageService, store) {
        this.route = route;
        this.dynamicTabPageService = dynamicTabPageService;
        this.store = store;
        this.alertService = injector.get(AlertService);
        this.storage = injector.get(LocalService);
        this.CompositePageWidget$ = this.store.select(selectAllGridsterItems);
    }
    ngOnInit() {
        this.compositePageId = this.route.snapshot.paramMap.get('compositePageId');
        this.id = this.route.snapshot.paramMap.get('id');
        if (window.location.pathname.includes('composite-page/view')) {
            this.editMode = false;
        }
        this.getDynamicPage(this.compositePageId);
    }
    ngAfterViewInit() {
        this.route.paramMap.subscribe(() => {
            this.compositePageId = this.route.snapshot.paramMap.get('compositePageId');
            this.id = this.route.snapshot.paramMap.get('id');
            this.getDynamicPage(this.compositePageId);
        });
    }
    getDynamicPage(compositePageId) {
        this.dynamicTabPageService.getDynamicPage(compositePageId).subscribe(value => {
            const activeversionid = value['data'][0].activeversionid;
            this.dynamicTabPageService.getActivePage(activeversionid, this.editMode).subscribe(resu => {
                if (resu) {
                    const compositePageconfig = typeof resu['data'].masterviewconfig === 'string'
                        ? JSON.parse(resu['data'].masterviewconfig)
                        : resu['data'].masterviewconfig;
                    if (compositePageconfig) {
                        compositePageconfig.forEach((x, index) => {
                            x.loadedFromCompositePage = true;
                            x.input = { ...x.input, componentId: x.id, id: this.id };
                            if (x.componentName === 'dynamicpage-common') {
                                x.component = DynamicPageComponent;
                            }
                            else if (x.componentName === 'dynamicpage-form') {
                                x.component = FormPageComponent;
                            }
                            else if (x.componentName === 'dynamicpage-sea') {
                                x.component = DynamicSearchComponent;
                            }
                            if (x?.settings?.defaultState == 'EXP') {
                                this.activeIndexes.push(index);
                            }
                        });
                        this.store.dispatch(setComponents({ components: compositePageconfig }));
                    }
                }
            });
        }, error => {
            this.alertService.error('Something went wrong');
            console.error(error);
        });
    }
    ngOnDestroy() {
        this.store.dispatch(clearComponents());
    }
    static ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "16.2.12", ngImport: i0, type: CompositePageComponent, deps: [{ token: i0.Injector }, { token: i1.ActivatedRoute }, { token: i2.DynamicTabPageService }, { token: i3.Store }], target: i0.ɵɵFactoryTarget.Component });
    static ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "16.2.12", type: CompositePageComponent, selector: "app-composite-page", inputs: { compositePageId: "compositePageId" }, ngImport: i0, template: "\r\n<div class=\"float-container\">\r\n  <div class=\"float-child-right\">\r\n    <div class=\"dashboard-inner mt-0\">\r\n      <div class=\"float-child-right\">\r\n        <ng-container *ngFor=\"let item of CompositePageWidget$ | async; let i = index\">\r\n          <div [ngSwitch]=\"item?.settings?.defaultState\">\r\n            <p-accordion [multiple]=\"true\" *ngSwitchCase=\"'EXP'\" [activeIndex]=\"[0]\">\r\n              <p-accordionTab header=\"{{item.settings?.title || item.name}}\">\r\n                <div class=\"clearfix gridster-item-group card\">\r\n                  <div class=\"gridster-item-content card-body\">\r\n                    <ndc-dynamic [ndcDynamicComponent]=\"item.component\" [ndcDynamicInputs]=\"item.input\"></ndc-dynamic>\r\n                  </div>\r\n                </div>\r\n              </p-accordionTab>\r\n            </p-accordion>\r\n    \r\n            <div *ngSwitchCase=\"'DIV'\" class=\"clearfix gridster-item-group card mt-6\">\r\n              <h6 class=\"card-header\">{{ item.settings?.title || item.name }}</h6>\r\n              <div class=\"gridster-item-content card-body\">\r\n                <ndc-dynamic [ndcDynamicComponent]=\"item.component\" [ndcDynamicInputs]=\"item.input\"></ndc-dynamic>\r\n              </div>\r\n            </div>\r\n    \r\n            <p-accordion [multiple]=\"true\" *ngSwitchDefault>\r\n              <p-accordionTab header=\"{{item.settings?.title || item.name}}\">\r\n                <div class=\"clearfix gridster-item-group card\">\r\n                  <div class=\"gridster-item-content card-body\">\r\n                    <ndc-dynamic [ndcDynamicComponent]=\"item.component\" [ndcDynamicInputs]=\"item.input\"></ndc-dynamic>\r\n                  </div>\r\n                </div>\r\n              </p-accordionTab>\r\n            </p-accordion>\r\n          </div>\r\n        </ng-container>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</div>", styles: [".float-container .float-child-right{max-height:calc(100vh - 280px);overflow-y:auto;overflow-x:hidden}.float-container .float-child-right .close-button{position:absolute;top:2px;right:5px;cursor:pointer;color:#007cc3}.float-container .float-child-right .overallSec{padding-left:0}.float-container .gridster{display:inline-table;background:transparent;padding:0!important}.float-container .gridster-item{margin:0 0 15px!important;padding:0 12px 12px;overflow-y:auto}.float-container .gridster-item-content{position:relative;padding:0}.pull-right{padding:5px}.gridster{height:120vh;margin:0;padding:0;background-color:#b3b1b1}.gridster-container{margin-top:10px;margin-left:10px}.top-btn-left{width:150px;margin:5px}.top-btn-right{width:350px;margin:5px}.widget-header{background-color:#eee;cursor:default}.widget-header-btn{cursor:pointer}.header-margin-left{margin-left:5px}.header-margin-right{margin-right:5px}app-nomination-widget{height:100%}.widget-header-buttons{display:flex;align-items:center;justify-content:space-between}.widget-header-buttons h6{font-size:12px;text-transform:uppercase;font-weight:600;color:#2c2863}\n"], dependencies: [{ kind: "directive", type: i4.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { kind: "directive", type: i4.NgSwitch, selector: "[ngSwitch]", inputs: ["ngSwitch"] }, { kind: "directive", type: i4.NgSwitchCase, selector: "[ngSwitchCase]", inputs: ["ngSwitchCase"] }, { kind: "directive", type: i4.NgSwitchDefault, selector: "[ngSwitchDefault]" }, { kind: "directive", type: i5.DynamicIoDirective, selector: "[ndcDynamicInputs],[ndcDynamicOutputs]", inputs: ["ndcDynamicInputs", "ndcDynamicOutputs"], exportAs: ["ndcDynamicIo"] }, { kind: "component", type: i5.DynamicComponent, selector: "ndc-dynamic", inputs: ["ndcDynamicComponent", "ndcDynamicInjector", "ndcDynamicProviders", "ndcDynamicContent", "ndcDynamicNgModuleRef", "ndcDynamicEnvironmentInjector"], outputs: ["ndcDynamicCreated"] }, { kind: "component", type: i6.Accordion, selector: "p-accordion", inputs: ["multiple", "style", "styleClass", "expandIcon", "collapseIcon", "activeIndex", "selectOnFocus", "headerAriaLevel"], outputs: ["onClose", "onOpen", "activeIndexChange"] }, { kind: "component", type: i6.AccordionTab, selector: "p-accordionTab", inputs: ["id", "header", "headerStyle", "tabStyle", "contentStyle", "tabStyleClass", "headerStyleClass", "contentStyleClass", "disabled", "cache", "transitionOptions", "iconPos", "selected", "headerAriaLevel"], outputs: ["selectedChange"] }, { kind: "pipe", type: i4.AsyncPipe, name: "async" }] });
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "16.2.12", ngImport: i0, type: CompositePageComponent, decorators: [{
            type: Component,
            args: [{ selector: 'app-composite-page', template: "\r\n<div class=\"float-container\">\r\n  <div class=\"float-child-right\">\r\n    <div class=\"dashboard-inner mt-0\">\r\n      <div class=\"float-child-right\">\r\n        <ng-container *ngFor=\"let item of CompositePageWidget$ | async; let i = index\">\r\n          <div [ngSwitch]=\"item?.settings?.defaultState\">\r\n            <p-accordion [multiple]=\"true\" *ngSwitchCase=\"'EXP'\" [activeIndex]=\"[0]\">\r\n              <p-accordionTab header=\"{{item.settings?.title || item.name}}\">\r\n                <div class=\"clearfix gridster-item-group card\">\r\n                  <div class=\"gridster-item-content card-body\">\r\n                    <ndc-dynamic [ndcDynamicComponent]=\"item.component\" [ndcDynamicInputs]=\"item.input\"></ndc-dynamic>\r\n                  </div>\r\n                </div>\r\n              </p-accordionTab>\r\n            </p-accordion>\r\n    \r\n            <div *ngSwitchCase=\"'DIV'\" class=\"clearfix gridster-item-group card mt-6\">\r\n              <h6 class=\"card-header\">{{ item.settings?.title || item.name }}</h6>\r\n              <div class=\"gridster-item-content card-body\">\r\n                <ndc-dynamic [ndcDynamicComponent]=\"item.component\" [ndcDynamicInputs]=\"item.input\"></ndc-dynamic>\r\n              </div>\r\n            </div>\r\n    \r\n            <p-accordion [multiple]=\"true\" *ngSwitchDefault>\r\n              <p-accordionTab header=\"{{item.settings?.title || item.name}}\">\r\n                <div class=\"clearfix gridster-item-group card\">\r\n                  <div class=\"gridster-item-content card-body\">\r\n                    <ndc-dynamic [ndcDynamicComponent]=\"item.component\" [ndcDynamicInputs]=\"item.input\"></ndc-dynamic>\r\n                  </div>\r\n                </div>\r\n              </p-accordionTab>\r\n            </p-accordion>\r\n          </div>\r\n        </ng-container>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</div>", styles: [".float-container .float-child-right{max-height:calc(100vh - 280px);overflow-y:auto;overflow-x:hidden}.float-container .float-child-right .close-button{position:absolute;top:2px;right:5px;cursor:pointer;color:#007cc3}.float-container .float-child-right .overallSec{padding-left:0}.float-container .gridster{display:inline-table;background:transparent;padding:0!important}.float-container .gridster-item{margin:0 0 15px!important;padding:0 12px 12px;overflow-y:auto}.float-container .gridster-item-content{position:relative;padding:0}.pull-right{padding:5px}.gridster{height:120vh;margin:0;padding:0;background-color:#b3b1b1}.gridster-container{margin-top:10px;margin-left:10px}.top-btn-left{width:150px;margin:5px}.top-btn-right{width:350px;margin:5px}.widget-header{background-color:#eee;cursor:default}.widget-header-btn{cursor:pointer}.header-margin-left{margin-left:5px}.header-margin-right{margin-right:5px}app-nomination-widget{height:100%}.widget-header-buttons{display:flex;align-items:center;justify-content:space-between}.widget-header-buttons h6{font-size:12px;text-transform:uppercase;font-weight:600;color:#2c2863}\n"] }]
        }], ctorParameters: function () { return [{ type: i0.Injector }, { type: i1.ActivatedRoute }, { type: i2.DynamicTabPageService }, { type: i3.Store }]; }, propDecorators: { compositePageId: [{
                type: Input
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29tcG9zaXRlLXBhZ2UuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvcGljcy1jb3JlL2R5bmFtaWMvc3JjL2xpYi9waWNzLWR5bmFtaWMvY29tcG9zaXRlLXBhZ2UvY29tcG9zaXRlLXBhZ2UuY29tcG9uZW50LnRzIiwiLi4vLi4vLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvcGljcy1jb3JlL2R5bmFtaWMvc3JjL2xpYi9waWNzLWR5bmFtaWMvY29tcG9zaXRlLXBhZ2UvY29tcG9zaXRlLXBhZ2UuY29tcG9uZW50Lmh0bWwiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFNBQVMsRUFBWSxLQUFLLEVBQXFCLE1BQU0sZUFBZSxDQUFDO0FBRzlFLE9BQU8sRUFBRSxzQkFBc0IsRUFBRSxNQUFNLDRDQUE0QyxDQUFDO0FBSXBGLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxnQ0FBZ0MsQ0FBQztBQUM5RCxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sZ0NBQWdDLENBQUM7QUFFOUQsT0FBTyxFQUFFLHNCQUFzQixFQUFFLE1BQU0sb0RBQW9ELENBQUM7QUFDNUYsT0FBTyxFQUFFLGVBQWUsRUFBRSxhQUFhLEVBQUUsTUFBTSxrREFBa0QsQ0FBQztBQUNsRyxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxtREFBbUQsQ0FBQztBQUN0RixPQUFPLEVBQUUsb0JBQW9CLEVBQUUsTUFBTSx5REFBeUQsQ0FBQzs7Ozs7Ozs7QUFDL0YsZ0pBQWdKO0FBT2hKLE1BQU0sT0FBTyxzQkFBc0I7SUFXdkI7SUFDQTtJQUNBO0lBWlYsb0JBQW9CLENBQStCO0lBQzFDLGVBQWUsQ0FBQztJQUN6QixFQUFFLENBQU87SUFDVCxZQUFZLENBQWU7SUFDM0IsT0FBTyxDQUFlO0lBQ3RCLFFBQVEsR0FBWSxJQUFJLENBQUM7SUFDekIsYUFBYSxHQUFhLEVBQUUsQ0FBQztJQUU3QixZ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QUFvQixFQUFFO2dDQUU1QyxDQUFDLENBQUMsU0FBUyxHQUFHLG9CQUFvQixDQUFDOzZCQUNwQztpQ0FDSSxJQUFJLENBQUMsQ0FBQyxhQUFhLEtBQUssa0JBQWtCLEVBQUU7Z0NBRS9DLENBQUMsQ0FBQyxTQUFTLEdBQUcsaUJBQWlCLENBQUM7NkJBQ2pDO2lDQUNJLElBQUksQ0FBQyxDQUFDLGFBQWEsS0FBSyxpQkFBaUIsRUFBRTtnQ0FDOUMsQ0FBQyxDQUFDLFNBQVMsR0FBRyxzQkFBc0IsQ0FBQzs2QkFDdEM7NEJBRUQsSUFBSSxDQUFDLEVBQUUsUUFBUSxFQUFFLFlBQVksSUFBSSxLQUFLLEVBQUU7Z0NBQ3RDLElBQUksQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDOzZCQUNoQzt3QkFDSCxDQUFDLENBQUMsQ0FBQzt3QkFDSCxJQUFJLENBQUMsS0FBSyxDQUFDLFFBQVEsQ0FBQyxhQUFhLENBQUMsRUFBRSxVQUFVLEVBQUUsbUJBQW1CLEVBQUUsQ0FBQyxDQUFDLENBQUM7cUJBQ3pFO2lCQUNGO1lBQ0gsQ0FBQyxDQUFDLENBQUM7UUFDTCxDQUFDLEVBQ0QsS0FBSyxDQUFDLEVBQUU7WUFDTixJQUFJLENBQUMsWUFBWSxDQUFDLEtBQUssQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDO1lBQ2hELE9BQU8sQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDdkIsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDO0lBRUQsV0FBVztRQUNULElBQUksQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLGVBQWUsRUFBRSxDQUFDLENBQUM7SUFDekMsQ0FBQzt3R0FoRlUsc0JBQXNCOzRGQUF0QixzQkFBc0IsMEdDckJuQyxzNURBc0NNOzs0RkRqQk8sc0JBQXNCO2tCQUxsQyxTQUFTOytCQUNFLG9CQUFvQjtvTEFNckIsZUFBZTtzQkFBdkIsS0FBSyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgSW5qZWN0b3IsIElucHV0LCBPbkluaXQsIE9uRGVzdHJveSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBBY3RpdmF0ZWRSb3V0ZSB9IGZyb20gJ0Bhbmd1bGFyL3JvdXRlcic7XHJcbmltcG9ydCB7IER5bmFtaWNUYWJQYWdlU2VydmljZSB9IGZyb20gJy4uL0Bjb3JlL3NlcnZpY2UvZHluYW1pYy10YWItcGFnZS1zZXJ2aWNlJztcclxuaW1wb3J0IHsgRHluYW1pY1NlYXJjaENvbXBvbmVudCB9IGZyb20gJy4uL2R5bmFtaWMtc2VhcmNoL2R5bmFtaWMtc2VhcmNoLmNvbXBvbmVudCc7XHJcbmltcG9ydCB7IE9ic2VydmFibGUgfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHsgU3RvcmUgfSBmcm9tICdAbmdyeC9zdG9yZSc7XHJcbmltcG9ydCB7IEFwcFN0YXRlIH0gZnJvbSAnLi4vQGNvcmUvY29yZS5zdGF0ZSc7XHJcbmltcG9ydCB7IEFsZXJ0U2VydmljZSB9IGZyb20gJy4uL0Bjb3JlL3NlcnZpY2UvYWxlcnQuc2VydmljZSc7XHJcbmltcG9ydCB7IExvY2FsU2VydmljZSB9IGZyb20gJy4uL0Bjb3JlL3NlcnZpY2UvbG9jYWwuc2VydmljZSc7XHJcbmltcG9ydCB7IENvbXBvbmVudFN0YXRlIH0gZnJvbSAnLi4vQHNoYXJlZC9tYXN0ZXItdmlldy1zdGF0ZS9tYXN0ZXItdmlldy5zdGF0ZSc7XHJcbmltcG9ydCB7IHNlbGVjdEFsbEdyaWRzdGVySXRlbXMgfSBmcm9tICcuLi9Ac2hhcmVkL21hc3Rlci12aWV3LXN0YXRlL21hc3Rlci12aWV3LnNlbGVjdG9ycyc7XHJcbmltcG9ydCB7IGNsZWFyQ29tcG9uZW50cywgc2V0Q29tcG9uZW50cyB9IGZyb20gJy4uL0BzaGFyZWQvbWFzdGVyLXZpZXctc3RhdGUvbWFzdGVyLXZpZXcuYWN0aW9ucyc7XHJcbmltcG9ydCB7IEZvcm1QYWdlQ29tcG9uZW50IH0gZnJvbSAnLi4vZHluYW1pYy10YWItcGFnZS9mb3JtLXBhZ2UvZm9ybS1wYWdlLmNvbXBvbmVudCc7XHJcbmltcG9ydCB7IER5bmFtaWNQYWdlQ29tcG9uZW50IH0gZnJvbSAnLi4vZHluYW1pYy10YWItcGFnZS9keW5hbWljLXBhZ2UvZHluYW1pYy1wYWdlLmNvbXBvbmVudCc7XHJcbi8vIGltcG9ydCB7IER5bmFtaWNQYWdlTW9kaWZ5QnlwYWdlaWRDb21wb25lbnQgfSBmcm9tICcuLi9keW5hbWljLXRhYi1wYWdlL2R5bmFtaWMtcGFnZS1tb2RpZnktYnlwYWdlaWQvZHluYW1pYy1wYWdlLW1vZGlmeS1ieXBhZ2VpZC5jb21wb25lbnQnO1xyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgc2VsZWN0b3I6ICdhcHAtY29tcG9zaXRlLXBhZ2UnLFxyXG4gIHRlbXBsYXRlVXJsOiAnLi9jb21wb3NpdGUtcGFnZS5jb21wb25lbnQuaHRtbCcsXHJcbiAgc3R5bGVVcmxzOiBbJy4vY29tcG9zaXRlLXBhZ2UuY29tcG9uZW50LnNjc3MnXVxyXG59KVxyXG5leHBvcnQgY2xhc3MgQ29tcG9zaXRlUGFnZUNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgT25EZXN0cm95IHtcclxuICBDb21wb3NpdGVQYWdlV2lkZ2V0JDogT2JzZXJ2YWJsZTxDb21wb25lbnRTdGF0ZVtdPjtcclxuICBASW5wdXQoKSBjb21wb3NpdGVQYWdlSWQ7XHJcbiAgaWQgOiBhbnk7XHJcbiAgYWxlcnRTZXJ2aWNlOiBBbGVydFNlcnZpY2U7XHJcbiAgc3RvcmFnZTogTG9jYWxTZXJ2aWNlO1xyXG4gIGVkaXRNb2RlOiBib29sZWFuID0gdHJ1ZTtcclxuICBhY3RpdmVJbmRleGVzOiBudW1iZXJbXSA9IFtdO1xyXG5cclxuICBjb25zdHJ1Y3RvcihcclxuICAgIGluamVjdG9yOiBJbmplY3RvcixcclxuICAgIHByaXZhdGUgcm91dGU6IEFjdGl2YXRlZFJvdXRlLFxyXG4gICAgcHJpdmF0ZSBkeW5hbWljVGFiUGFnZVNlcnZpY2U6IER5bmFtaWNUYWJQYWdlU2VydmljZSxcclxuICAgIHByaXZhdGUgc3RvcmU6IFN0b3JlPEFwcFN0YXRlPlxyXG4gICkge1xyXG4gICAgdGhpcy5hbGVydFNlcnZpY2UgPSBpbmplY3Rvci5nZXQ8QWxlcnRTZXJ2aWNlPihBbGVydFNlcnZpY2UpO1xyXG4gICAgdGhpcy5zdG9yYWdlID0gaW5qZWN0b3IuZ2V0PExvY2FsU2VydmljZT4oTG9jYWxTZXJ2aWNlKTtcclxuICAgIHRoaXMuQ29tcG9zaXRlUGFnZVdpZGdldCQgPSB0aGlzLnN0b3JlLnNlbGVjdChzZWxlY3RBbGxHcmlkc3Rlckl0ZW1zKTtcclxuICB9XHJcblxyXG4gIG5nT25Jbml0KCk6IHZvaWQge1xyXG4gICAgdGhpcy5jb21wb3NpdGVQYWdlSWQgPSB0aGlzLnJvdXRlLnNuYXBzaG90LnBhcmFtTWFwLmdldCgnY29tcG9zaXRlUGFnZUlkJyk7XHJcbiAgICB0aGlzLmlkID0gdGhpcy5yb3V0ZS5zbmFwc2hvdC5wYXJhbU1hcC5nZXQoJ2lkJyk7XHJcblxyXG4gICAgaWYod2luZG93LmxvY2F0aW9uLnBhdGhuYW1lLmluY2x1ZGVzKCdjb21wb3NpdGUtcGFnZS92aWV3Jykpe1xyXG4gICAgICB0aGlzLmVkaXRNb2RlID0gZmFsc2U7XHJcbiAgICB9XHJcbiAgICB0aGlzLmdldER5bmFtaWNQYWdlKHRoaXMuY29tcG9zaXRlUGFnZUlkKTtcclxuICB9XHJcblxyXG4gIG5nQWZ0ZXJWaWV3SW5pdCgpOiB2b2lkIHtcclxuICAgIHRoaXMucm91dGUucGFyYW1NYXAuc3Vic2NyaWJlKCgpID0+IHtcclxuICAgICAgdGhpcy5jb21wb3NpdGVQYWdlSWQgPSB0aGlzLnJvdXRlLnNuYXBzaG90LnBhcmFtTWFwLmdldCgnY29tcG9zaXRlUGFnZUlkJyk7XHJcbiAgICAgIHRoaXMuaWQgPSB0aGlzLnJvdXRlLnNuYXBzaG90LnBhcmFtTWFwLmdldCgnaWQnKTtcclxuICAgICAgdGhpcy5nZXREeW5hbWljUGFnZSh0aGlzLmNvbXBvc2l0ZVBhZ2VJZCk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGdldER5bmFtaWNQYWdlKGNvbXBvc2l0ZVBhZ2VJZCkge1xyXG4gICAgdGhpcy5keW5hbWljVGFiUGFnZVNlcnZpY2UuZ2V0RHluYW1pY1BhZ2UoY29tcG9zaXRlUGFnZUlkKS5zdWJzY3JpYmUodmFsdWUgPT4ge1xyXG4gICAgICBjb25zdCBhY3RpdmV2ZXJzaW9uaWQgPSB2YWx1ZVsnZGF0YSddWzBdLmFjdGl2ZXZlcnNpb25pZDtcclxuICAgICAgdGhpcy5keW5hbWljVGFiUGFnZVNlcnZpY2UuZ2V0QWN0aXZlUGFnZShhY3RpdmV2ZXJzaW9uaWQsIHRoaXMuZWRpdE1vZGUpLnN1YnNjcmliZShyZXN1ID0+IHtcclxuICAgICAgICBpZiAocmVzdSkge1xyXG4gICAgICAgICAgY29uc3QgY29tcG9zaXRlUGFnZWNvbmZpZyA9IHR5cGVvZiByZXN1WydkYXRhJ10ubWFzdGVydmlld2NvbmZpZyA9PT0gJ3N0cmluZydcclxuICAgICAgICAgICAgPyBKU09OLnBhcnNlKHJlc3VbJ2RhdGEnXS5tYXN0ZXJ2aWV3Y29uZmlnKVxyXG4gICAgICAgICAgICA6IHJlc3VbJ2RhdGEnXS5tYXN0ZXJ2aWV3Y29uZmlnO1xyXG5cclxuICAgICAgICAgIGlmIChjb21wb3NpdGVQYWdlY29uZmlnKSB7XHJcbiAgICAgICAgICAgIGNvbXBvc2l0ZVBhZ2Vjb25maWcuZm9yRWFjaCgoeCwgaW5kZXgpID0+IHtcclxuICAgICAgICAgICAgICB4LmxvYWRlZEZyb21Db21wb3NpdGVQYWdlID0gdHJ1ZTtcclxuICAgICAgICAgICAgICB4LmlucHV0ID0geyAuLi54LmlucHV0LCBjb21wb25lbnRJZDogeC5pZCwgaWQgOiB0aGlzLmlkfTtcclxuICAgICAgICAgICAgICBpZiAoeC5jb21wb25lbnROYW1lID09PSAnZHluYW1pY3BhZ2UtY29tbW9uJykge1xyXG4gICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgeC5jb21wb25lbnQgPSBEeW5hbWljUGFnZUNvbXBvbmVudDtcclxuICAgICAgICAgICAgICB9IFxyXG4gICAgICAgICAgICAgIGVsc2UgaWYgKHguY29tcG9uZW50TmFtZSA9PT0gJ2R5bmFtaWNwYWdlLWZvcm0nKSB7XHJcbiAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICB4LmNvbXBvbmVudCA9IEZvcm1QYWdlQ29tcG9uZW50O1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICBlbHNlIGlmICh4LmNvbXBvbmVudE5hbWUgPT09ICdkeW5hbWljcGFnZS1zZWEnKSB7XHJcbiAgICAgICAgICAgICAgICB4LmNvbXBvbmVudCA9IER5bmFtaWNTZWFyY2hDb21wb25lbnQ7XHJcbiAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICBpZiAoeD8uc2V0dGluZ3M/LmRlZmF1bHRTdGF0ZSA9PSAnRVhQJykge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5hY3RpdmVJbmRleGVzLnB1c2goaW5kZXgpO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHRoaXMuc3RvcmUuZGlzcGF0Y2goc2V0Q29tcG9uZW50cyh7IGNvbXBvbmVudHM6IGNvbXBvc2l0ZVBhZ2Vjb25maWcgfSkpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgICB9LFxyXG4gICAgZXJyb3IgPT4ge1xyXG4gICAgICB0aGlzLmFsZXJ0U2VydmljZS5lcnJvcignU29tZXRoaW5nIHdlbnQgd3JvbmcnKTtcclxuICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIG5nT25EZXN0cm95KCk6IHZvaWQge1xyXG4gICAgdGhpcy5zdG9yZS5kaXNwYXRjaChjbGVhckNvbXBvbmVudHMoKSk7XHJcbiAgfVxyXG59XHJcbiIsIlxyXG48ZGl2IGNsYXNzPVwiZmxvYXQtY29udGFpbmVyXCI+XHJcbiAgPGRpdiBjbGFzcz1cImZsb2F0LWNoaWxkLXJpZ2h0XCI+XHJcbiAgICA8ZGl2IGNsYXNzPVwiZGFzaGJvYXJkLWlubmVyIG10LTBcIj5cclxuICAgICAgPGRpdiBjbGFzcz1cImZsb2F0LWNoaWxkLXJpZ2h0XCI+XHJcbiAgICAgICAgPG5nLWNvbnRhaW5lciAqbmdGb3I9XCJsZXQgaXRlbSBvZiBDb21wb3NpdGVQYWdlV2lkZ2V0JCB8IGFzeW5jOyBsZXQgaSA9IGluZGV4XCI+XHJcbiAgICAgICAgICA8ZGl2IFtuZ1N3aXRjaF09XCJpdGVtPy5zZXR0aW5ncz8uZGVmYXVsdFN0YXRlXCI+XHJcbiAgICAgICAgICAgIDxwLWFjY29yZGlvbiBbbXVsdGlwbGVdPVwidHJ1ZVwiICpuZ1N3aXRjaENhc2U9XCInRVhQJ1wiIFthY3RpdmVJbmRleF09XCJbMF1cIj5cclxuICAgICAgICAgICAgICA8cC1hY2NvcmRpb25UYWIgaGVhZGVyPVwie3tpdGVtLnNldHRpbmdzPy50aXRsZSB8fCBpdGVtLm5hbWV9fVwiPlxyXG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cImNsZWFyZml4IGdyaWRzdGVyLWl0ZW0tZ3JvdXAgY2FyZFwiPlxyXG4gICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiZ3JpZHN0ZXItaXRlbS1jb250ZW50IGNhcmQtYm9keVwiPlxyXG4gICAgICAgICAgICAgICAgICAgIDxuZGMtZHluYW1pYyBbbmRjRHluYW1pY0NvbXBvbmVudF09XCJpdGVtLmNvbXBvbmVudFwiIFtuZGNEeW5hbWljSW5wdXRzXT1cIml0ZW0uaW5wdXRcIj48L25kYy1keW5hbWljPlxyXG4gICAgICAgICAgICAgICAgICA8L2Rpdj5cclxuICAgICAgICAgICAgICAgIDwvZGl2PlxyXG4gICAgICAgICAgICAgIDwvcC1hY2NvcmRpb25UYWI+XHJcbiAgICAgICAgICAgIDwvcC1hY2NvcmRpb24+XHJcbiAgICBcclxuICAgICAgICAgICAgPGRpdiAqbmdTd2l0Y2hDYXNlPVwiJ0RJVidcIiBjbGFzcz1cImNsZWFyZml4IGdyaWRzdGVyLWl0ZW0tZ3JvdXAgY2FyZCBtdC02XCI+XHJcbiAgICAgICAgICAgICAgPGg2IGNsYXNzPVwiY2FyZC1oZWFkZXJcIj57eyBpdGVtLnNldHRpbmdzPy50aXRsZSB8fCBpdGVtLm5hbWUgfX08L2g2PlxyXG4gICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJncmlkc3Rlci1pdGVtLWNvbnRlbnQgY2FyZC1ib2R5XCI+XHJcbiAgICAgICAgICAgICAgICA8bmRjLWR5bmFtaWMgW25kY0R5bmFtaWNDb21wb25lbnRdPVwiaXRlbS5jb21wb25lbnRcIiBbbmRjRHluYW1pY0lucHV0c109XCJpdGVtLmlucHV0XCI+PC9uZGMtZHluYW1pYz5cclxuICAgICAgICAgICAgICA8L2Rpdj5cclxuICAgICAgICAgICAgPC9kaXY+XHJcbiAgICBcclxuICAgICAgICAgICAgPHAtYWNjb3JkaW9uIFttdWx0aXBsZV09XCJ0cnVlXCIgKm5nU3dpdGNoRGVmYXVsdD5cclxuICAgICAgICAgICAgICA8cC1hY2NvcmRpb25UYWIgaGVhZGVyPVwie3tpdGVtLnNldHRpbmdzPy50aXRsZSB8fCBpdGVtLm5hbWV9fVwiPlxyXG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cImNsZWFyZml4IGdyaWRzdGVyLWl0ZW0tZ3JvdXAgY2FyZFwiPlxyXG4gICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiZ3JpZHN0ZXItaXRlbS1jb250ZW50IGNhcmQtYm9keVwiPlxyXG4gICAgICAgICAgICAgICAgICAgIDxuZGMtZHluYW1pYyBbbmRjRHluYW1pY0NvbXBvbmVudF09XCJpdGVtLmNvbXBvbmVudFwiIFtuZGNEeW5hbWljSW5wdXRzXT1cIml0ZW0uaW5wdXRcIj48L25kYy1keW5hbWljPlxyXG4gICAgICAgICAgICAgICAgICA8L2Rpdj5cclxuICAgICAgICAgICAgICAgIDwvZGl2PlxyXG4gICAgICAgICAgICAgIDwvcC1hY2NvcmRpb25UYWI+XHJcbiAgICAgICAgICAgIDwvcC1hY2NvcmRpb24+XHJcbiAgICAgICAgICA8L2Rpdj5cclxuICAgICAgICA8L25nLWNvbnRhaW5lcj5cclxuICAgICAgPC9kaXY+XHJcbiAgICA8L2Rpdj5cclxuICA8L2Rpdj5cclxuPC9kaXY+Il19
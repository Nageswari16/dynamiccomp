import { Component, Input } from '@angular/core';
import { options } from './options';
import { DynamicSearchComponent } from '../dynamic-search/dynamic-search.component';
import { selectAllGridsterItems } from '../@shared/master-view-state/master-view.selectors';
import { clearComponents, setComponents } from '../@shared/master-view-state/master-view.actions';
import { AlertService } from '../@core/service/alert.service';
import { FormPageComponent } from '../dynamic-tab-page/form-page/form-page.component';
import { DynamicPageComponent } from '../dynamic-tab-page/dynamic-page/dynamic-page.component';
import * as i0 from "@angular/core";
import * as i1 from "@angular/router";
import * as i2 from "../@core/service/dynamic-tab-page-service";
import * as i3 from "@ngrx/store";
import * as i4 from "@angular/common";
import * as i5 from "angular-gridster2";
import * as i6 from "ng-dynamic-component";
import * as i7 from "../@shared/alert/alert.component";
export class MasterViewComponent {
    route;
    dynamicTabPageService;
    store;
    options;
    masterViewWidget$;
    masterPageId;
    alertService;
    editMode = true;
    constructor(injector, route, dynamicTabPageService, store) {
        this.route = route;
        this.dynamicTabPageService = dynamicTabPageService;
        this.store = store;
        this.options = options;
        this.alertService = injector.get(AlertService);
        this.masterViewWidget$ = this.store.select(selectAllGridsterItems);
    }
    ngOnInit() {
        this.masterPageId = this.route.snapshot.paramMap.get('masterPageId');
        if (window.location.pathname.includes('master-view/view')) {
            this.editMode = false;
        }
        this.getDynamicPage(this.masterPageId);
    }
    getDynamicPage(masterPageId) {
        this.dynamicTabPageService.getDynamicPage(masterPageId).subscribe(value => {
            const activeversionid = value['data'][0].activeversionid;
            this.dynamicTabPageService.getActivePage(activeversionid, this.editMode).subscribe(result => {
                if (result) {
                    const masterviewconfig = typeof result['data'].masterviewconfig === 'string'
                        ? JSON.parse(result['data'].masterviewconfig)
                        : result['data'].masterviewconfig;
                    if (masterviewconfig) {
                        masterviewconfig.forEach(x => {
                            x.loadedFromMasterView = true;
                            x.input = { ...x.input, componentId: x.id };
                            if (x.componentName === 'dynamicpage-common') {
                                x.component = DynamicPageComponent;
                            }
                            else if (x.componentName === 'dynamicpage-form') {
                                x.component = FormPageComponent;
                            }
                            else if (x.componentName === 'dynamicpage-sea') {
                                x.component = DynamicSearchComponent;
                            }
                        });
                        this.store.dispatch(setComponents({ components: masterviewconfig }));
                    }
                }
            });
        }, error => {
            this.alertService.error('Something went wrong');
            console.error(error);
        });
    }
    ngAfterViewInit() {
        this.route.paramMap.subscribe(() => {
            this.masterPageId = this.route.snapshot.paramMap.get('masterPageId');
            this.getDynamicPage(this.masterPageId);
        });
    }
    ngOnDestroy() {
        this.store.dispatch(clearComponents());
    }
    static ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "16.2.12", ngImport: i0, type: MasterViewComponent, deps: [{ token: i0.Injector }, { token: i1.ActivatedRoute }, { token: i2.DynamicTabPageService }, { token: i3.Store }], target: i0.ɵɵFactoryTarget.Component });
    static ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "16.2.12", type: MasterViewComponent, selector: "app-master-view", inputs: { masterPageId: "masterPageId" }, ngImport: i0, template: "<app-alert></app-alert>\r\n<div class=\"float-container\">\r\n  <div class=\"float-child-right\">\r\n    <div class=\"dashboard-inner mt-0\">\r\n      <div class=\"float-child-right\">\r\n        <gridster class=\"gridster\" [options]=\"options\">\r\n          <gridster-item class=\"gridster-item\" [item]=\"item\"\r\n            *ngFor=\"let item of masterViewWidget$ | async; let i = index\">\r\n            <div class=\"clearfix gridster-item-group\">\r\n              <div class=\"gridster-item-content\">\r\n                <!-- <div class=\"drag-handler widget-header p-2 mb-2\">\r\n                  <div class=\"item-buttons widget-header-buttons w-100\">\r\n                    <h6 class=\"mb-0\">{{ item.name }}</h6>\r\n                  </div>\r\n                </div>-->\r\n                <ndc-dynamic [ndcDynamicComponent]=\"item.component\" [ndcDynamicInputs]=\"item.input\"> </ndc-dynamic>\r\n              </div>\r\n            </div>\r\n          </gridster-item>\r\n        </gridster>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</div>", styles: [".float-container .float-child-right{max-height:calc(100vh - 280px);overflow-y:auto}.float-container .float-child-right .close-button{position:absolute;top:2px;right:5px;cursor:pointer;color:#007cc3}.float-container .float-child-right .overallSec{padding-left:0}.float-container .gridster{display:inline-table;background:transparent;padding:0!important}.float-container .gridster-item{margin:0 0 15px!important;padding:0 12px 12px;overflow-y:auto}.float-container .gridster-item-content{position:relative}.pull-right{padding:5px}.gridster{height:120vh;margin:0;padding:0;background-color:#b3b1b1}.gridster-container{margin-top:10px;margin-left:10px}.top-btn-left{width:150px;margin:5px}.top-btn-right{width:350px;margin:5px}.widget-header{background-color:#eee;cursor:default}.widget-header-btn{cursor:pointer}.header-margin-left{margin-left:5px}.header-margin-right{margin-right:5px}app-nomination-widget{height:100%}.widget-header-buttons{display:flex;align-items:center;justify-content:space-between}.widget-header-buttons h6{font-size:12px;text-transform:uppercase;font-weight:600;color:#2c2863}\n"], dependencies: [{ kind: "directive", type: i4.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { kind: "component", type: i5.GridsterComponent, selector: "gridster", inputs: ["options"] }, { kind: "component", type: i5.GridsterItemComponent, selector: "gridster-item", inputs: ["item"], outputs: ["itemInit", "itemChange", "itemResize"] }, { kind: "directive", type: i6.DynamicIoDirective, selector: "[ndcDynamicInputs],[ndcDynamicOutputs]", inputs: ["ndcDynamicInputs", "ndcDynamicOutputs"], exportAs: ["ndcDynamicIo"] }, { kind: "component", type: i6.DynamicComponent, selector: "ndc-dynamic", inputs: ["ndcDynamicComponent", "ndcDynamicInjector", "ndcDynamicProviders", "ndcDynamicContent", "ndcDynamicNgModuleRef", "ndcDynamicEnvironmentInjector"], outputs: ["ndcDynamicCreated"] }, { kind: "component", type: i7.AlertComponent, selector: "app-alert" }, { kind: "pipe", type: i4.AsyncPipe, name: "async" }] });
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "16.2.12", ngImport: i0, type: MasterViewComponent, decorators: [{
            type: Component,
            args: [{ selector: 'app-master-view', template: "<app-alert></app-alert>\r\n<div class=\"float-container\">\r\n  <div class=\"float-child-right\">\r\n    <div class=\"dashboard-inner mt-0\">\r\n      <div class=\"float-child-right\">\r\n        <gridster class=\"gridster\" [options]=\"options\">\r\n          <gridster-item class=\"gridster-item\" [item]=\"item\"\r\n            *ngFor=\"let item of masterViewWidget$ | async; let i = index\">\r\n            <div class=\"clearfix gridster-item-group\">\r\n              <div class=\"gridster-item-content\">\r\n                <!-- <div class=\"drag-handler widget-header p-2 mb-2\">\r\n                  <div class=\"item-buttons widget-header-buttons w-100\">\r\n                    <h6 class=\"mb-0\">{{ item.name }}</h6>\r\n                  </div>\r\n                </div>-->\r\n                <ndc-dynamic [ndcDynamicComponent]=\"item.component\" [ndcDynamicInputs]=\"item.input\"> </ndc-dynamic>\r\n              </div>\r\n            </div>\r\n          </gridster-item>\r\n        </gridster>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</div>", styles: [".float-container .float-child-right{max-height:calc(100vh - 280px);overflow-y:auto}.float-container .float-child-right .close-button{position:absolute;top:2px;right:5px;cursor:pointer;color:#007cc3}.float-container .float-child-right .overallSec{padding-left:0}.float-container .gridster{display:inline-table;background:transparent;padding:0!important}.float-container .gridster-item{margin:0 0 15px!important;padding:0 12px 12px;overflow-y:auto}.float-container .gridster-item-content{position:relative}.pull-right{padding:5px}.gridster{height:120vh;margin:0;padding:0;background-color:#b3b1b1}.gridster-container{margin-top:10px;margin-left:10px}.top-btn-left{width:150px;margin:5px}.top-btn-right{width:350px;margin:5px}.widget-header{background-color:#eee;cursor:default}.widget-header-btn{cursor:pointer}.header-margin-left{margin-left:5px}.header-margin-right{margin-right:5px}app-nomination-widget{height:100%}.widget-header-buttons{display:flex;align-items:center;justify-content:space-between}.widget-header-buttons h6{font-size:12px;text-transform:uppercase;font-weight:600;color:#2c2863}\n"] }]
        }], ctorParameters: function () { return [{ type: i0.Injector }, { type: i1.ActivatedRoute }, { type: i2.DynamicTabPageService }, { type: i3.Store }]; }, propDecorators: { masterPageId: [{
                type: Input
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFzdGVyLXZpZXcuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvcGljcy1jb3JlL2R5bmFtaWMvc3JjL2xpYi9waWNzLWR5bmFtaWMvbWFzdGVyLXZpZXcvbWFzdGVyLXZpZXcuY29tcG9uZW50LnRzIiwiLi4vLi4vLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvcGljcy1jb3JlL2R5bmFtaWMvc3JjL2xpYi9waWNzLWR5bmFtaWMvbWFzdGVyLXZpZXcvbWFzdGVyLXZpZXcuY29tcG9uZW50Lmh0bWwiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFNBQVMsRUFBWSxLQUFLLEVBQVUsTUFBTSxlQUFlLENBQUM7QUFHbkUsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLFdBQVcsQ0FBQztBQUVwQyxPQUFPLEVBQUUsc0JBQXNCLEVBQUUsTUFBTSw0Q0FBNEMsQ0FBQztBQUdwRixPQUFPLEVBQUUsc0JBQXNCLEVBQUUsTUFBTSxvREFBb0QsQ0FBQztBQUc1RixPQUFPLEVBQUUsZUFBZSxFQUFFLGFBQWEsRUFBRSxNQUFNLGtEQUFrRCxDQUFDO0FBRWxHLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxnQ0FBZ0MsQ0FBQztBQUM5RCxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxtREFBbUQsQ0FBQztBQUN0RixPQUFPLEVBQUUsb0JBQW9CLEVBQUUsTUFBTSx5REFBeUQsQ0FBQzs7Ozs7Ozs7O0FBTy9GLE1BQU0sT0FBTyxtQkFBbUI7SUFTcEI7SUFDQTtJQUNBO0lBVlYsT0FBTyxDQUFpQjtJQUN4QixpQkFBaUIsQ0FBK0I7SUFDdkMsWUFBWSxDQUFDO0lBQ3RCLFlBQVksQ0FBZTtJQUMzQixRQUFRLEdBQVksSUFBSSxDQUFDO0lBRXpCLFlBQ0UsUUFBa0IsRUFDVixLQUFxQixFQUNyQixxQkFBNEMsRUFDNUMsS0FBc0I7UUFGdEIsVUFBSyxHQUFMLEtBQUssQ0FBZ0I7UUFDckIsMEJBQXFCLEdBQXJCLHFCQUFxQixDQUF1QjtRQUM1QyxVQUFLLEdBQUwsS0FBSyxDQUFpQjtRQUU5QixJQUFJLENBQUMsT0FBTyxHQUFHLE9BQU8sQ0FBQztRQUN2QixJQUFJLENBQUMsWUFBWSxHQUFHLFFBQVEsQ0FBQyxHQUFHLENBQWUsWUFBWSxDQUFDLENBQUM7UUFDN0QsSUFBSSxDQUFDLGlCQUFpQixHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLHNCQUFzQixDQUFDLENBQUM7SUFDckUsQ0FBQztJQUVELFFBQVE7UUFDTixJQUFJLENBQUMsWUFBWSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsY0FBYyxDQUFDLENBQUM7UUFDckUsSUFBRyxNQUFNLENBQUMsUUFBUSxDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsa0JBQWtCLENBQUMsRUFBQztZQUN2RCxJQUFJLENBQUMsUUFBUSxHQUFHLEtBQUssQ0FBQztTQUN2QjtRQUNELElBQUksQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFDO0lBQ3pDLENBQUM7SUFFRCxjQUFjLENBQUMsWUFBWTtRQUN6QixJQUFJLENBQUMscUJBQXFCLENBQUMsY0FBYyxDQUFDLFlBQVksQ0FBQyxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsRUFBRTtZQUN4RSxNQUFNLGVBQWUsR0FBRyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsZUFBZSxDQUFDO1lBQ3pELElBQUksQ0FBQyxxQkFBcUIsQ0FBQyxhQUFhLENBQUMsZUFBZSxFQUFFLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLEVBQUU7Z0JBQzFGLElBQUksTUFBTSxFQUFFO29CQUNWLE1BQU0sZ0JBQWdCLEdBQUcsT0FBTyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsZ0JBQWdCLEtBQUssUUFBUTt3QkFDMUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLGdCQUFnQixDQUFDO3dCQUM3QyxDQUFDLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLGdCQUFnQixDQUFDO29CQUVwQyxJQUFJLGdCQUFnQixFQUFFO3dCQUNwQixnQkFBZ0IsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLEVBQUU7NEJBQzNCLENBQUMsQ0FBQyxvQkFBb0IsR0FBRyxJQUFJLENBQUM7NEJBQzlCLENBQUMsQ0FBQyxLQUFLLEdBQUcsRUFBRSxHQUFHLENBQUMsQ0FBQyxLQUFLLEVBQUUsV0FBVyxFQUFFLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQzs0QkFDNUMsSUFBSSxDQUFDLENBQUMsYUFBYSxLQUFLLG9CQUFvQixFQUFFO2dDQUM1QyxDQUFDLENBQUMsU0FBUyxHQUFHLG9CQUFvQixDQUFDOzZCQUNwQztpQ0FDSSxJQUFJLENBQUMsQ0FBQyxhQUFhLEtBQUssa0JBQWtCLEVBQUU7Z0NBQy9DLENBQUMsQ0FBQyxTQUFTLEdBQUcsaUJBQWlCLENBQUM7NkJBQ2pDO2lDQUNJLElBQUksQ0FBQyxDQUFDLGFBQWEsS0FBSyxpQkFBaUIsRUFBRTtnQ0FDOUMsQ0FBQyxDQUFDLFNBQVMsR0FBRyxzQkFBc0IsQ0FBQzs2QkFDdEM7d0JBQ0gsQ0FBQyxDQUFDLENBQUM7d0JBQ0gsSUFBSSxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsYUFBYSxDQUFDLEVBQUUsVUFBVSxFQUFFLGdCQUFnQixFQUFFLENBQUMsQ0FBQyxDQUFDO3FCQUN0RTtpQkFDRjtZQUNILENBQUMsQ0FBQyxDQUFDO1FBQ0wsQ0FBQyxFQUNDLEtBQUssQ0FBQyxFQUFFO1lBQ04sSUFBSSxDQUFDLFlBQVksQ0FBQyxLQUFLLENBQUMsc0JBQXNCLENBQUMsQ0FBQztZQUNoRCxPQUFPLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ3ZCLENBQUMsQ0FBQyxDQUFDO0lBQ1AsQ0FBQztJQUVELGVBQWU7UUFDYixJQUFJLENBQUMsS0FBSyxDQUFDLFFBQVEsQ0FBQyxTQUFTLENBQUMsR0FBRyxFQUFFO1lBQ2pDLElBQUksQ0FBQyxZQUFZLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxjQUFjLENBQUMsQ0FBQztZQUNyRSxJQUFJLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQztRQUN6QyxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUM7SUFFRCxXQUFXO1FBQ1QsSUFBSSxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsZUFBZSxFQUFFLENBQUMsQ0FBQztJQUN6QyxDQUFDO3dHQXJFVSxtQkFBbUI7NEZBQW5CLG1CQUFtQixpR0N0QmhDLG9pQ0F1Qk07OzRGRERPLG1CQUFtQjtrQkFML0IsU0FBUzsrQkFDRSxpQkFBaUI7b0xBT2xCLFlBQVk7c0JBQXBCLEtBQUsiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIEluamVjdG9yLCBJbnB1dCwgT25Jbml0IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IEFjdGl2YXRlZFJvdXRlIH0gZnJvbSAnQGFuZ3VsYXIvcm91dGVyJztcclxuaW1wb3J0IHsgR3JpZHN0ZXJDb25maWcgfSBmcm9tICdhbmd1bGFyLWdyaWRzdGVyMic7XHJcbmltcG9ydCB7IG9wdGlvbnMgfSBmcm9tICcuL29wdGlvbnMnO1xyXG5pbXBvcnQgeyBEeW5hbWljVGFiUGFnZVNlcnZpY2UgfSBmcm9tICcuLi9AY29yZS9zZXJ2aWNlL2R5bmFtaWMtdGFiLXBhZ2Utc2VydmljZSc7XHJcbmltcG9ydCB7IER5bmFtaWNTZWFyY2hDb21wb25lbnQgfSBmcm9tICcuLi9keW5hbWljLXNlYXJjaC9keW5hbWljLXNlYXJjaC5jb21wb25lbnQnO1xyXG5pbXBvcnQgeyBDb21wb25lbnRTdGF0ZSB9IGZyb20gJy4uL0BzaGFyZWQvbWFzdGVyLXZpZXctc3RhdGUvbWFzdGVyLXZpZXcuc3RhdGUnO1xyXG5pbXBvcnQgeyBPYnNlcnZhYmxlIH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IHNlbGVjdEFsbEdyaWRzdGVySXRlbXMgfSBmcm9tICcuLi9Ac2hhcmVkL21hc3Rlci12aWV3LXN0YXRlL21hc3Rlci12aWV3LnNlbGVjdG9ycyc7XHJcbmltcG9ydCB7IFN0b3JlIH0gZnJvbSAnQG5ncngvc3RvcmUnO1xyXG5pbXBvcnQgeyBBcHBTdGF0ZSB9IGZyb20gJy4uL0Bjb3JlL2NvcmUuc3RhdGUnO1xyXG5pbXBvcnQgeyBjbGVhckNvbXBvbmVudHMsIHNldENvbXBvbmVudHMgfSBmcm9tICcuLi9Ac2hhcmVkL21hc3Rlci12aWV3LXN0YXRlL21hc3Rlci12aWV3LmFjdGlvbnMnO1xyXG5pbXBvcnQgeyBQbGF0Zm9ybURhdGFTdG9yZVNlcnZpY2UgfSBmcm9tICcuLi9AY29yZS9zZXJ2aWNlL3BsYXRmb3JtLWRhdGEtc3RvcmUuc2VydmljZSc7XHJcbmltcG9ydCB7IEFsZXJ0U2VydmljZSB9IGZyb20gJy4uL0Bjb3JlL3NlcnZpY2UvYWxlcnQuc2VydmljZSc7XHJcbmltcG9ydCB7IEZvcm1QYWdlQ29tcG9uZW50IH0gZnJvbSAnLi4vZHluYW1pYy10YWItcGFnZS9mb3JtLXBhZ2UvZm9ybS1wYWdlLmNvbXBvbmVudCc7XHJcbmltcG9ydCB7IER5bmFtaWNQYWdlQ29tcG9uZW50IH0gZnJvbSAnLi4vZHluYW1pYy10YWItcGFnZS9keW5hbWljLXBhZ2UvZHluYW1pYy1wYWdlLmNvbXBvbmVudCc7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICBzZWxlY3RvcjogJ2FwcC1tYXN0ZXItdmlldycsXHJcbiAgdGVtcGxhdGVVcmw6ICcuL21hc3Rlci12aWV3LmNvbXBvbmVudC5odG1sJyxcclxuICBzdHlsZVVybHM6IFsnLi9tYXN0ZXItdmlldy5jb21wb25lbnQuc2NzcyddXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBNYXN0ZXJWaWV3Q29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcclxuICBvcHRpb25zOiBHcmlkc3RlckNvbmZpZztcclxuICBtYXN0ZXJWaWV3V2lkZ2V0JDogT2JzZXJ2YWJsZTxDb21wb25lbnRTdGF0ZVtdPjtcclxuICBASW5wdXQoKSBtYXN0ZXJQYWdlSWQ7XHJcbiAgYWxlcnRTZXJ2aWNlOiBBbGVydFNlcnZpY2U7XHJcbiAgZWRpdE1vZGU6IGJvb2xlYW4gPSB0cnVlO1xyXG5cclxuICBjb25zdHJ1Y3RvcihcclxuICAgIGluamVjdG9yOiBJbmplY3RvcixcclxuICAgIHByaXZhdGUgcm91dGU6IEFjdGl2YXRlZFJvdXRlLFxyXG4gICAgcHJpdmF0ZSBkeW5hbWljVGFiUGFnZVNlcnZpY2U6IER5bmFtaWNUYWJQYWdlU2VydmljZSxcclxuICAgIHByaXZhdGUgc3RvcmU6IFN0b3JlPEFwcFN0YXRlPlxyXG4gICkge1xyXG4gICAgdGhpcy5vcHRpb25zID0gb3B0aW9ucztcclxuICAgIHRoaXMuYWxlcnRTZXJ2aWNlID0gaW5qZWN0b3IuZ2V0PEFsZXJ0U2VydmljZT4oQWxlcnRTZXJ2aWNlKTtcclxuICAgIHRoaXMubWFzdGVyVmlld1dpZGdldCQgPSB0aGlzLnN0b3JlLnNlbGVjdChzZWxlY3RBbGxHcmlkc3Rlckl0ZW1zKTtcclxuICB9XHJcblxyXG4gIG5nT25Jbml0KCk6IHZvaWQge1xyXG4gICAgdGhpcy5tYXN0ZXJQYWdlSWQgPSB0aGlzLnJvdXRlLnNuYXBzaG90LnBhcmFtTWFwLmdldCgnbWFzdGVyUGFnZUlkJyk7XHJcbiAgICBpZih3aW5kb3cubG9jYXRpb24ucGF0aG5hbWUuaW5jbHVkZXMoJ21hc3Rlci12aWV3L3ZpZXcnKSl7XHJcbiAgICAgIHRoaXMuZWRpdE1vZGUgPSBmYWxzZTtcclxuICAgIH1cclxuICAgIHRoaXMuZ2V0RHluYW1pY1BhZ2UodGhpcy5tYXN0ZXJQYWdlSWQpO1xyXG4gIH1cclxuXHJcbiAgZ2V0RHluYW1pY1BhZ2UobWFzdGVyUGFnZUlkKSB7XHJcbiAgICB0aGlzLmR5bmFtaWNUYWJQYWdlU2VydmljZS5nZXREeW5hbWljUGFnZShtYXN0ZXJQYWdlSWQpLnN1YnNjcmliZSh2YWx1ZSA9PiB7XHJcbiAgICAgIGNvbnN0IGFjdGl2ZXZlcnNpb25pZCA9IHZhbHVlWydkYXRhJ11bMF0uYWN0aXZldmVyc2lvbmlkO1xyXG4gICAgICB0aGlzLmR5bmFtaWNUYWJQYWdlU2VydmljZS5nZXRBY3RpdmVQYWdlKGFjdGl2ZXZlcnNpb25pZCwgdGhpcy5lZGl0TW9kZSkuc3Vic2NyaWJlKHJlc3VsdCA9PiB7XHJcbiAgICAgICAgaWYgKHJlc3VsdCkge1xyXG4gICAgICAgICAgY29uc3QgbWFzdGVydmlld2NvbmZpZyA9IHR5cGVvZiByZXN1bHRbJ2RhdGEnXS5tYXN0ZXJ2aWV3Y29uZmlnID09PSAnc3RyaW5nJ1xyXG4gICAgICAgICAgICA/IEpTT04ucGFyc2UocmVzdWx0WydkYXRhJ10ubWFzdGVydmlld2NvbmZpZylcclxuICAgICAgICAgICAgOiByZXN1bHRbJ2RhdGEnXS5tYXN0ZXJ2aWV3Y29uZmlnO1xyXG5cclxuICAgICAgICAgIGlmIChtYXN0ZXJ2aWV3Y29uZmlnKSB7XHJcbiAgICAgICAgICAgIG1hc3RlcnZpZXdjb25maWcuZm9yRWFjaCh4ID0+IHtcclxuICAgICAgICAgICAgICB4LmxvYWRlZEZyb21NYXN0ZXJWaWV3ID0gdHJ1ZTtcclxuICAgICAgICAgICAgICB4LmlucHV0ID0geyAuLi54LmlucHV0LCBjb21wb25lbnRJZDogeC5pZCB9O1xyXG4gICAgICAgICAgICAgIGlmICh4LmNvbXBvbmVudE5hbWUgPT09ICdkeW5hbWljcGFnZS1jb21tb24nKSB7XHJcbiAgICAgICAgICAgICAgICB4LmNvbXBvbmVudCA9IER5bmFtaWNQYWdlQ29tcG9uZW50O1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICBlbHNlIGlmICh4LmNvbXBvbmVudE5hbWUgPT09ICdkeW5hbWljcGFnZS1mb3JtJykge1xyXG4gICAgICAgICAgICAgICAgeC5jb21wb25lbnQgPSBGb3JtUGFnZUNvbXBvbmVudDtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgZWxzZSBpZiAoeC5jb21wb25lbnROYW1lID09PSAnZHluYW1pY3BhZ2Utc2VhJykge1xyXG4gICAgICAgICAgICAgICAgeC5jb21wb25lbnQgPSBEeW5hbWljU2VhcmNoQ29tcG9uZW50O1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHRoaXMuc3RvcmUuZGlzcGF0Y2goc2V0Q29tcG9uZW50cyh7IGNvbXBvbmVudHM6IG1hc3RlcnZpZXdjb25maWcgfSkpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgICB9LFxyXG4gICAgICBlcnJvciA9PiB7XHJcbiAgICAgICAgdGhpcy5hbGVydFNlcnZpY2UuZXJyb3IoJ1NvbWV0aGluZyB3ZW50IHdyb25nJyk7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XHJcbiAgICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgbmdBZnRlclZpZXdJbml0KCk6IHZvaWQge1xyXG4gICAgdGhpcy5yb3V0ZS5wYXJhbU1hcC5zdWJzY3JpYmUoKCkgPT4ge1xyXG4gICAgICB0aGlzLm1hc3RlclBhZ2VJZCA9IHRoaXMucm91dGUuc25hcHNob3QucGFyYW1NYXAuZ2V0KCdtYXN0ZXJQYWdlSWQnKTtcclxuICAgICAgdGhpcy5nZXREeW5hbWljUGFnZSh0aGlzLm1hc3RlclBhZ2VJZCk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIG5nT25EZXN0cm95KCk6IHZvaWQge1xyXG4gICAgdGhpcy5zdG9yZS5kaXNwYXRjaChjbGVhckNvbXBvbmVudHMoKSk7XHJcbiAgfVxyXG59IiwiPGFwcC1hbGVydD48L2FwcC1hbGVydD5cclxuPGRpdiBjbGFzcz1cImZsb2F0LWNvbnRhaW5lclwiPlxyXG4gIDxkaXYgY2xhc3M9XCJmbG9hdC1jaGlsZC1yaWdodFwiPlxyXG4gICAgPGRpdiBjbGFzcz1cImRhc2hib2FyZC1pbm5lciBtdC0wXCI+XHJcbiAgICAgIDxkaXYgY2xhc3M9XCJmbG9hdC1jaGlsZC1yaWdodFwiPlxyXG4gICAgICAgIDxncmlkc3RlciBjbGFzcz1cImdyaWRzdGVyXCIgW29wdGlvbnNdPVwib3B0aW9uc1wiPlxyXG4gICAgICAgICAgPGdyaWRzdGVyLWl0ZW0gY2xhc3M9XCJncmlkc3Rlci1pdGVtXCIgW2l0ZW1dPVwiaXRlbVwiXHJcbiAgICAgICAgICAgICpuZ0Zvcj1cImxldCBpdGVtIG9mIG1hc3RlclZpZXdXaWRnZXQkIHwgYXN5bmM7IGxldCBpID0gaW5kZXhcIj5cclxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cImNsZWFyZml4IGdyaWRzdGVyLWl0ZW0tZ3JvdXBcIj5cclxuICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiZ3JpZHN0ZXItaXRlbS1jb250ZW50XCI+XHJcbiAgICAgICAgICAgICAgICA8IS0tIDxkaXYgY2xhc3M9XCJkcmFnLWhhbmRsZXIgd2lkZ2V0LWhlYWRlciBwLTIgbWItMlwiPlxyXG4gICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiaXRlbS1idXR0b25zIHdpZGdldC1oZWFkZXItYnV0dG9ucyB3LTEwMFwiPlxyXG4gICAgICAgICAgICAgICAgICAgIDxoNiBjbGFzcz1cIm1iLTBcIj57eyBpdGVtLm5hbWUgfX08L2g2PlxyXG4gICAgICAgICAgICAgICAgICA8L2Rpdj5cclxuICAgICAgICAgICAgICAgIDwvZGl2Pi0tPlxyXG4gICAgICAgICAgICAgICAgPG5kYy1keW5hbWljIFtuZGNEeW5hbWljQ29tcG9uZW50XT1cIml0ZW0uY29tcG9uZW50XCIgW25kY0R5bmFtaWNJbnB1dHNdPVwiaXRlbS5pbnB1dFwiPiA8L25kYy1keW5hbWljPlxyXG4gICAgICAgICAgICAgIDwvZGl2PlxyXG4gICAgICAgICAgICA8L2Rpdj5cclxuICAgICAgICAgIDwvZ3JpZHN0ZXItaXRlbT5cclxuICAgICAgICA8L2dyaWRzdGVyPlxyXG4gICAgICA8L2Rpdj5cclxuICAgIDwvZGl2PlxyXG4gIDwvZGl2PlxyXG48L2Rpdj4iXX0=